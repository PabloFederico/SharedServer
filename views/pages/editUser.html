<html>
<head>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link type="text/css" rel="stylesheet" href="/css/materialize.css">
<link type="text/css" rel="stylesheet" href="/css/main.css">
</head>
<body>
<header>
	<nav class="main-navigator">
		<div class="nav-wrapper">
		  <a href="#" class="brand-logo">MatchApp</a>
		  <ul id="nav-mobile" class="right">
			<li class="active"><a href="/form_viewUser">Usuarios</a></li>
			<li><a href="/form_viewInterests">Intereses</a></li>
		  </ul>
		</div>
	</nav>
	<nav class="breadcrumbs">
		<div class="nav-wrapper">
		  <div class="col s12">
			<a href="/" class="breadcrumb">Home</a>
			<a href="/form_viewUser" class="breadcrumb">Usuarios</a>
			<a href="#" class="breadcrumb">Editar Usuario</a>
		  </div>
		</div>
	</nav>
</header>
<main>
	<div class="container">
		 <h2 class="header center-align">Editar usuario</h2>
		      <div class="row">
				<div class="col s12 m12">
				  <div class="card">
					<div class="card-content">
					  <form id="myform" class="form-horizontal">
						<div class="form-group">
						  <label for="inputNombre" class="col-sm-2 control-label">Nombre</label>
						  <div class="col-sm-10">
							<input type="text" class="form-control" id="inputNombre" placeholder="Nombre" name="name">
						  </div>
						</div>
						<div class="form-group">
						  <label for="inputAlias" class="col-sm-2 control-label">Alias</label>
						  <div class="col-sm-10">
							<input type="text" class="form-control" id="inputAlias" placeholder="Alias" name="username">
						  </div>
						</div>
						<div class="form-group">
						  <label for="inputEmail" class="col-sm-2 control-label">Password</label>
						  <div class="col-sm-10">
							<input type="text" class="form-control" id="inputPassword" placeholder="Password" name="password">
						  </div>
						</div>

					   <div class="form-group">
						  <label for="inputSex" class="col-sm-2 control-label">Sex</label>
						  <div class="col-sm-10">
							<select id="inputSex" placeholder="Sex" name="sex"  class="form-control browser-default">
							   <option value="F">F</option>
							   <option value="M">M</option>
							</select>
						  </div>
						</div>

					   <div class="form-group">
						  <label for="inputAge" class="col-sm-2 control-label">Age</label>
						  <div class="col-sm-10">
							<input type="text" class="form-control" id="inputAge" placeholder="Age" name="age">
						  </div>
						</div>

						<div class="form-group">
						  <label for="inputEmail" class="col-sm-2 control-label">Email</label>
						  <div class="col-sm-10">
							<input type="text" class="form-control" id="inputEmail" placeholder="Email" name="email">
						  </div>
						</div>
					  <div class="form-group">
						<label for="inputInterest" class="col-sm-2 control-label">Interests</label>
						<div class="col-sm-10">
						  <select class="form-control browser-default" id="inputInterest" name="interests" multiple></select>
						</div>
					  </div>

					  <div class="form-group">
						<label for="inputEmail" class="col-sm-2 control-label">Latitud</label>
						<div class="col-sm-10">
						  <input type="text" class="form-control" id="inputLatit" placeholder="Latitud" name="latitude">
						</div>
					  </div>
					  <div class="form-group">
						<label for="inputEmail" class="col-sm-2 control-label">Longitud</label>
						<div class="col-sm-10">
						  <input type="text" class="form-control" id="inputLongi" placeholder="Longitud" name="longitude">
						</div>
					  </div>
					  <div class="form-group">
						<label for="inputfile" class="col-sm-2 control-label">Imagen</label>
						<div class="col-sm-10">
						  <input type="file" class="form-control" id="inputfile" placeholder="file" name="file">
						</div>
					  </div>
					  <div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
						  <button type="submit" class="btn btn-large">Enviar <i class="material-icons right">send</i></button>
						</div>
					  </div>
					</form>
					</div>
				  </div>
				</div>
			  </div>
	</div>
</main>
<footer class="page-footer">
  <div class="container">
	<div class="row">
	  <div class="col l6 s12">
		<h5 class="white-text">Grupo 10</h5>
	  </div>
	</div>
  </div>
  <div class="footer-copyright">
	<div class="container">
	1er cuatrimestre 2016
	<a class="grey-text text-lighten-4 right" href="http://www.7552.fi.uba.ar/">Taller de programacion II</a>
	</div>
  </div>
</footer>
<script type="text/javascript" src="/js/jquery-2.1.1.min.js"></script>
<script type="text/javascript"  src="/js/materialize.js"></script>
<script type="text/javascript">
var interests = null;
    var id_global = null;
    $(document).ready(function(){
     var midata = null;
     var user_id = window.location.href;
     user_id = parseInt((user_id).split("=")[1]);
     var foundUser = null;
     $.ajax({
      url: "/users",
      type: "GET",
      contentType: 'application/json; charset=utf-8',
      success: function(resultData) {
        for (var i = 0; i < resultData.users.length; i++) {
          var user = resultData.users[i];
          var userJson = user.user;
          var id = userJson.id;
          var name = userJson.name;
          var email = userJson.email;
	  var sexo = userJson.sex;
	  var edad = userJson.age;
	  interests = userJson.interests;
          var alias = userJson.alias;
          var latitude = userJson.location.latitude;
          var longitude = userJson.location.longitude;

          if(id == user_id) {
            $("#inputNombre").val(name);
            $("#inputEmail").val(email);
            $("#inputAlias").val(alias);
	    $("#inputAge").val(edad);
	    $("#inputSex").val(sexo);
            $("#inputLatit").val(latitude);
            $("#inputLongi").val(longitude);
            id_global = id;
            break;
          }
        }
      },
      error : function(jqXHR, textStatus, errorThrown) {
      },
      timeout: 120000,
    });

  $.ajax({
        url: "/interests",
        type: "GET",
        contentType: 'application/json; charset=utf-8',
        success: function(resultData) {
          for (var i = 0; i < resultData.interests.length; i++) {
            var interest = resultData.interests[i];
            var interestJson = interest.interest;
            var id = interestJson.id;
            var category = interestJson.category;
            var value = interestJson.value;
            var complete = category+'-'+value;

		    if(interests && interests.indexOf(complete) >  -1){
		   	 $("#inputInterest").append('<option selected>'+complete+'</option>');}
		    else{
		    $("#inputInterest").append('<option>'+complete+'</option>');
 		    }
          }
        },
        error : function(jqXHR, textStatus, errorThrown) {
        },
        timeout: 120000,
      });

  });


function edit(){
  var modifyData = [$("#inputNombre").val(),$("#inputAlias").val(),$("#inputPassword").val(),$("#inputEmail").val(),$("#inputLatit").val(),$("#inputLongi").val(),$("#inputAge").val(),$("#inputSex").val(), $("#inputInterest").val()];
  $.ajax({
   type: 'PUT',
   dataType: 'json', 
   url: "users/"+id_global, 
   data: "name="+modifyData[0]+"&alias="+modifyData[1]+"&password="+modifyData[2]+"&age="+modifyData[6]+"&email="+modifyData[3]+"&latitude="+modifyData[4]+"&longitude="+modifyData[5]+"&sex="+modifyData[7]+"&interests="+modifyData[8]+""
 });
  alert("Usuario modificado satisfactoriamente");
  window.location.href = "/";
}
	</script>
</body>
</html>
